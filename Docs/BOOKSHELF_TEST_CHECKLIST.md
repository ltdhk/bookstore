# 书架功能本地化测试清单

## 📱 测试环境准备
- [ ] Flutter环境正常
- [ ] 应用已编译成功
- [ ] 设备/模拟器已连接
- [ ] 应用已安装到设备

## 🧪 功能测试

### 1. 阅读器页面书架功能 (reader_screen.dart)

#### 测试场景1: 检查书架状态（未添加的书）
- [ ] 打开一本未添加到书架的书籍
- [ ] 点击右下角设置按钮打开菜单
- [ ] 观察书架按钮图标（应显示"+"符号）
- [ ] **预期结果**: 图标显示加号，表示未添加

#### 测试场景2: 添加书籍到书架
- [ ] 在阅读器页面，点击书架按钮
- [ ] 观察提示消息"Added to bookshelf"
- [ ] 观察按钮图标变为"✓"
- [ ] **预期结果**:
  - 显示成功提示
  - 图标从"+"变为"✓"
  - 无网络请求发出

#### 测试场景3: 移除书籍
- [ ] 在已添加状态下，再次点击书架按钮
- [ ] 观察提示消息"Removed from bookshelf"
- [ ] 观察按钮图标变回"+"
- [ ] **预期结果**:
  - 显示移除提示
  - 图标从"✓"变回"+"
  - 无网络请求发出

#### 测试场景4: 状态持久化
- [ ] 添加书籍到书架
- [ ] 退出阅读器页面
- [ ] 重新进入同一本书的阅读器
- [ ] 观察按钮状态
- [ ] **预期结果**: 按钮显示"✓"，状态保持

### 2. 书籍详情页书架功能 (book_detail_screen.dart)

#### 测试场景5: 未添加状态
- [ ] 从首页进入一本未添加的书籍详情页
- [ ] 观察底部"Add to Bookshelf"按钮
- [ ] 检查按钮样式和图标
- [ ] **预期结果**:
  - 显示"Add to Bookshelf"
  - 加号图标
  - 主题色边框

#### 测试场景6: 添加书籍
- [ ] 点击"Add to Bookshelf"按钮
- [ ] 观察提示消息
- [ ] 观察按钮变化
- [ ] **预期结果**:
  - 显示"Added to bookshelf"提示
  - 按钮变为"In Bookshelf"
  - 勾选图标
  - 红色边框
  - 操作即时完成（<100ms）

#### 测试场景7: 移除书籍
- [ ] 点击"In Bookshelf"按钮
- [ ] 观察提示消息
- [ ] 观察按钮恢复
- [ ] **预期结果**:
  - 显示"Removed from bookshelf"提示
  - 按钮恢复为"Add to Bookshelf"

### 3. 书架页面功能 (bookshelf_screen.dart)

#### 测试场景8: 查看书架
- [ ] 点击底部导航"Bookshelf"
- [ ] 观察书架中的书籍
- [ ] 验证之前添加的书籍是否存在
- [ ] **预期结果**:
  - 显示所有已添加的书籍
  - 封面、标题显示正确
  - 按添加时间排序

#### 测试场景9: 删除单本书籍
- [ ] 点击"Edit"按钮进入编辑模式
- [ ] 选择一本书籍
- [ ] 点击"Delete"按钮
- [ ] 在对话框中确认删除
- [ ] **预期结果**:
  - 书籍从列表中移除
  - 显示删除成功提示
  - 即时完成

#### 测试场景10: 批量删除
- [ ] 进入编辑模式
- [ ] 选择多本书籍（3本以上）
- [ ] 点击"Delete"按钮
- [ ] 确认删除
- [ ] **预期结果**:
  - 所有选中书籍被移除
  - 提示消息正确

### 4. 跨页面状态同步测试

#### 测试场景11: 详情页→书架页
- [ ] 在书籍详情页添加一本书
- [ ] 进入书架页面
- [ ] 验证书籍是否出现
- [ ] **预期结果**: 书籍立即出现在书架中

#### 测试场景12: 书架页→详情页
- [ ] 在书架页删除一本书
- [ ] 进入该书的详情页
- [ ] 观察按钮状态
- [ ] **预期结果**: 按钮显示"Add to Bookshelf"

#### 测试场景13: 书架页→阅读器页
- [ ] 在书架页删除一本书
- [ ] 打开该书的阅读器
- [ ] 观察书架按钮状态
- [ ] **预期结果**: 按钮显示"+"图标

#### 测试场景14: 阅读器页→书架页
- [ ] 在阅读器页添加书籍
- [ ] 退出到书架页
- [ ] 验证书籍出现
- [ ] **预期结果**: 书籍显示在书架中

### 5. 数据持久化测试

#### 测试场景15: 应用重启
- [ ] 添加3-5本书到书架
- [ ] 完全关闭应用（不是后台）
- [ ] 重新启动应用
- [ ] 进入书架页面
- [ ] **预期结果**:
  - 所有书籍仍然存在
  - 数据完整
  - 顺序正确

#### 测试场景16: 跨状态验证
- [ ] 添加书籍到书架
- [ ] 关闭应用
- [ ] 重新打开
- [ ] 进入书籍详情页
- [ ] 验证按钮状态
- [ ] 进入阅读器
- [ ] 验证按钮状态
- [ ] **预期结果**: 所有页面状态一致

### 6. 离线功能测试

#### 测试场景17: 飞行模式测试
- [ ] 开启飞行模式（断网）
- [ ] 添加书籍到书架
- [ ] 移除书籍
- [ ] 进入编辑模式删除
- [ ] 验证所有操作
- [ ] **预期结果**:
  - 所有功能正常
  - 无错误提示
  - 操作流畅

#### 测试场景18: 网络恢复测试
- [ ] 在离线状态下操作书架
- [ ] 恢复网络连接
- [ ] 验证书架数据
- [ ] **预期结果**:
  - 数据未丢失
  - 状态正确

### 7. 边界情况测试

#### 测试场景19: 空书架
- [ ] 清空所有书架书籍
- [ ] 进入书架页面
- [ ] 观察显示
- [ ] **预期结果**:
  - 显示空状态
  - 无错误

#### 测试场景20: 大量书籍
- [ ] 添加20+本书到书架
- [ ] 观察加载速度
- [ ] 滚动列表
- [ ] 执行删除操作
- [ ] **预期结果**:
  - 流畅加载
  - 滚动顺畅
  - 操作无延迟

#### 测试场景21: 快速连续操作
- [ ] 快速连续点击添加按钮（5次）
- [ ] 观察结果
- [ ] **预期结果**:
  - 书籍只添加一次
  - 无重复
  - 无崩溃

#### 测试场景22: 同一本书重复添加
- [ ] 添加一本书到书架
- [ ] 从另一个入口再次添加同一本书
- [ ] 检查书架
- [ ] **预期结果**:
  - 书籍只出现一次
  - 无重复

### 8. 错误处理测试

#### 测试场景23: 异常数据
- [ ] 尝试添加缺少封面的书籍
- [ ] 尝试添加缺少标题的书籍
- [ ] 观察行为
- [ ] **预期结果**:
  - 使用默认值
  - 无崩溃
  - 显示适当提示

#### 测试场景24: 存储空间不足
- [ ] （可选）模拟存储空间不足
- [ ] 尝试添加书籍
- [ ] **预期结果**:
  - 显示错误提示
  - 不崩溃

## 🚫 反面测试（验证不调用API）

### 测试场景25: 网络监控
- [ ] 使用Charles/Fiddler等工具监控网络
- [ ] 执行所有书架操作
- [ ] 检查网络请求日志
- [ ] **预期结果**:
  - ❌ 无 `/api/v1/users/bookshelf/check` 请求
  - ❌ 无 POST `/api/v1/users/bookshelf` 请求
  - ❌ 无 DELETE `/api/v1/users/bookshelf` 请求

### 测试场景26: 后端服务关闭
- [ ] 确认后端服务未运行
- [ ] 执行所有书架操作
- [ ] **预期结果**:
  - ✅ 所有功能正常
  - ✅ 无错误提示

## 📊 性能测试

### 测试场景27: 响应时间
- [ ] 测量添加书籍的时间
- [ ] 测量移除书籍的时间
- [ ] 测量查询状态的时间
- [ ] **目标**:
  - 添加: <50ms
  - 移除: <50ms
  - 查询: <10ms

### 测试场景28: 内存使用
- [ ] 添加50本书
- [ ] 观察内存使用
- [ ] 删除所有书
- [ ] **预期结果**:
  - 内存无泄漏
  - 增长合理

## ✅ 测试结果汇总

| 测试场景 | 通过 | 失败 | 备注 |
|---------|------|------|------|
| 场景1-5 (阅读器) | ☐ | ☐ | |
| 场景6-8 (详情页) | ☐ | ☐ | |
| 场景9-10 (书架页) | ☐ | ☐ | |
| 场景11-14 (状态同步) | ☐ | ☐ | |
| 场景15-16 (持久化) | ☐ | ☐ | |
| 场景17-18 (离线) | ☐ | ☐ | |
| 场景19-22 (边界) | ☐ | ☐ | |
| 场景23-24 (错误) | ☐ | ☐ | |
| 场景25-26 (API验证) | ☐ | ☐ | |
| 场景27-28 (性能) | ☐ | ☐ | |

## 📝 Bug报告模板

如发现问题，请记录：

```
### Bug #[编号]
**场景**: [场景编号和名称]
**步骤**:
1.
2.
3.

**预期结果**:

**实际结果**:

**截图**:

**日志**:

**设备信息**:
- 设备型号:
- OS版本:
- 应用版本:
```

## 🎯 测试完成标准

所有测试通过的标准：
- ✅ 所有功能测试场景通过
- ✅ 状态同步正确
- ✅ 数据持久化工作正常
- ✅ 完全离线可用
- ✅ 无API调用
- ✅ 性能达标
- ✅ 无崩溃
- ✅ 无内存泄漏

## 📞 遇到问题？

如果测试中发现问题：
1. 查看控制台日志
2. 检查Flutter analyze输出
3. 参考 [BOOKSHELF_LOCAL_MIGRATION.md](BOOKSHELF_LOCAL_MIGRATION.md)
4. 联系开发团队
